<!-- app.html (MAIN APP) -->
<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#070A12" />
  <title>Memorize Game</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="app">
    <!-- Top HUD -->
    <header class="hud">
      <div class="hud__left">
        <div class="brand">
          <div class="brand__logo">MG</div>
          <div class="brand__text">
            <div class="brand__name">Memorize Game</div>
            <div class="brand__sub" id="todayLabel">—</div>
          </div>
        </div>
      </div>

      <div class="hud__right">
        <button class="pill pill--btn" id="btnUserMenu" type="button" title="الحساب">
          <span class="material-icons">account_circle</span>
          <span id="userNameLabel">—</span>
        </button>

        <div class="pill">
          <span class="material-icons">paid</span>
          <span id="goldLabel">0</span>
        </div>
        <div class="pill">
          <span class="material-icons">military_tech</span>
          <span id="rankLabel">—</span>
        </div>
        <div class="pill">
          <span class="material-icons">stars</span>
          <span id="xpLabel">LV 1</span>
        </div>
        <div class="pill">
          <span class="material-icons">local_fire_department</span>
          <span id="streakLabel">0</span>
        </div>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="nav">
      <button class="nav__btn active" data-view="home">
        <span class="material-icons">home</span><span>الرئيسية</span>
      </button>
      <button class="nav__btn" data-view="add">
        <span class="material-icons">add_circle</span><span>إضافة</span>
      </button>
      <button class="nav__btn" data-view="store">
        <span class="material-icons">storefront</span><span>المتجر</span>
      </button>
      <button class="nav__btn" data-view="cards">
        <span class="material-icons">style</span><span>البطاقات</span>
      </button>
    </nav>

    <!-- Views -->
    <main class="views">
      <!-- HOME -->
      <section class="view active" id="view-home">
        <div class="panel hero">
          <div class="hero__left">
            <h1>تعلّم مثل لعبة</h1>
            <p class="muted">
              العب 4 ألعاب عشوائية ثم قيّم في لعبة التلميح لتسجيل الحضور.
              <br/>المكافآت تُعتمد فقط بعد إنهاء التلميح.
            </p>

            <div class="hero__actions">
              <button class="btn btn--primary" id="btnStartPlay">
                <span class="material-icons">play_circle</span>
                بدأ اللعب
              </button>

              <button class="btn" id="btnQuickAdd">
                <span class="material-icons">add</span>
                إضافة بطاقة جديدة
              </button>
            </div>

            <div class="miniGrid">
              <div class="miniCard">
                <div class="miniCard__title">تقدّم XP</div>
                <div class="progress">
                  <div class="progress__bar" id="xpBar"></div>
                </div>
                <div class="miniCard__sub" id="xpSub">—</div>
              </div>

              <div class="miniCard">
                <div class="miniCard__title">تقدّم التصنيف</div>
                <div class="progress">
                  <div class="progress__bar" id="rankBar"></div>
                </div>
                <div class="miniCard__sub" id="rankSub">—</div>
              </div>

              <div class="miniCard">
                <div class="miniCard__title">دروس اليوم</div>
                <div class="bigNum" id="dueCountLabel">0</div>
                <div class="miniCard__sub" id="dueSub">—</div>
              </div>

              <div class="miniCard">
                <div class="miniCard__title">العناصر</div>
                <div class="itemsRow">
                  <span class="chip" id="chipSkip">تخطي: 0</span>
                  <span class="chip" id="chipHelp">مساعدة: 0</span>
                  <span class="chip" id="chipFuel">وقود: 0</span>
                </div>
                <div class="miniCard__sub">تُشترى من المتجر</div>
              </div>
            </div>
          </div>

          <div class="hero__right">
            <div class="glass">
              <div class="glass__title">قواعد سريعة</div>
              <ul class="rules">
                <li>لا حضور بدون إنهاء <b>التلميح</b> بالكامل.</li>
                <li>إذا سكّرت قبل التلميح: تُلغى مكافآت الألعاب الأربع.</li>
                <li>إضافة اليوم: <b>4</b> بطاقات إلزامي لأول مرة، أقصى <b>10</b> + بطاقتين مشتريات.</li>
                <li>أول مرة: معك <b>900</b> ذهب.</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- ADD -->
      <section class="view" id="view-add">
        <div class="panel">
          <div class="panel__head">
            <h2>إضافة بطاقات اليوم</h2>
            <div class="muted" id="addHint">—</div>
          </div>

          <div class="formGrid">
            <div class="field">
              <label>
                النص الأصلي
                <button class="qBtn" type="button" data-help="foreignHelp">?</button>
              </label>
              <input id="inFront" maxlength="45" placeholder="مثال: apple" />
              <div class="field__sub">حتى 45 حرف</div>
            </div>

            <div class="field">
              <label>
                الترجمة / المعنى
                <button class="qBtn" type="button" data-help="nativeHelp">?</button>
              </label>
              <input id="inBack" maxlength="45" placeholder="مثال: تفاحة" />
              <div class="field__sub">حتى 45 حرف</div>
            </div>

            <div class="field">
              <label>
                تلميح
                <button class="qBtn" type="button" data-help="hintHelp">?</button>
              </label>
              <input id="inHint" maxlength="60" placeholder="مثال: (فاكهة) أو رمز" />
              <div class="field__sub">حتى 60 حرف</div>
            </div>
          </div>

          <div class="rowActions">
            <button class="btn btn--primary" id="btnSaveCard">
              <span class="material-icons">save</span> حفظ البطاقة
            </button>
            <button class="btn btn--danger" id="btnExitAdd">
              <span class="material-icons">close</span> خروج
            </button>
          </div>

          <div class="divider"></div>
          <div class="statsLine" id="addStats">—</div>

          <div class="divider"></div>
          <div class="muted">بطاقات اليوم المضافة:</div>
          <div class="cardsList" id="todayList"></div>
        </div>
      </section>

      <!-- STORE -->
      <section class="view" id="view-store">
        <div class="panel">
          <div class="panel__head">
            <h2>المتجر</h2>
            <div class="muted">الشراء بالذهب فقط</div>
          </div>

          <div class="storeGrid">
            <div class="storeItem">
              <div class="storeItem__icon material-icons">note_add</div>
              <div class="storeItem__info">
                <div class="storeItem__title">بطاقة إضافية لليوم</div>
                <div class="storeItem__sub">ترفع الحد اليومي +1 (حتى بطاقتين شراء باليوم).</div>
              </div>
              <div class="storeItem__buy">
                <div class="price">100</div>
                <button class="btn btn--small btn--primary" data-buy="extraCard">شراء</button>
              </div>
            </div>

            <div class="storeItem">
              <div class="storeItem__icon material-icons">skip_next</div>
              <div class="storeItem__info">
                <div class="storeItem__title">تخطي لعبة</div>
                <div class="storeItem__sub">ينهي لعبة واحدة ويمنح مكاسب مثالية (عدا التلميح).</div>
              </div>
              <div class="storeItem__buy">
                <div class="price">900</div>
                <button class="btn btn--small btn--primary" data-buy="skip">شراء</button>
              </div>
            </div>

            <div class="storeItem">
              <div class="storeItem__icon material-icons">bolt</div>
              <div class="storeItem__info">
                <div class="storeItem__title">مساعدة</div>
                <div class="storeItem__sub">داخل الألعاب الأربع فقط (مع خصم 15% من ذهب اللعبة عند الاستخدام).</div>
              </div>
              <div class="storeItem__buy">
                <div class="price">150</div>
                <button class="btn btn--small btn--primary" data-buy="help">شراء</button>
              </div>
            </div>

            <div class="storeItem">
              <div class="storeItem__icon material-icons">local_gas_station</div>
              <div class="storeItem__info">
                <div class="storeItem__title">وقود</div>
                <div class="storeItem__sub">يحمي الستريك من الانطفاء عند غياب يوم واحد (يُستهلك تلقائيًا).</div>
              </div>
              <div class="storeItem__buy">
                <div class="price">250</div>
                <button class="btn btn--small btn--primary" data-buy="fuel">شراء</button>
              </div>
            </div>
          </div>

          <div class="divider"></div>
          <div class="muted">
            المخزون: <b id="invLine">—</b>
            <br/>ملاحظة: البطاقات الإضافية غير المستخدمة تُحذف غدًا ويعود لك 50% من ثمنها.
          </div>
        </div>
      </section>

      <!-- CARDS -->
      <section class="view" id="view-cards">
        <div class="panel">
          <div class="panel__head">
            <h2>كل البطاقات</h2>
            <div class="muted" id="cardsSub">اضغط البطاقة لعرض التفاصيل.</div>
          </div>

          <div class="searchRow">
            <input id="cardsSearch" placeholder="بحث..." />
            <button class="btn btn--small" id="btnExport">
              <span class="material-icons">download</span> تصدير JSON
            </button>
            <label class="btn btn--small btn--ghost fileBtn">
              <span class="material-icons">upload</span> استيراد JSON
              <input type="file" id="importFile" accept="application/json" hidden />
            </label>
          </div>

          <div class="cardsList" id="cardsList"></div>
        </div>
      </section>

      <!-- GAME -->
      <section class="view" id="view-game">
        <div class="panel gamePanel">
          <div class="gameTop">
            <div class="gameTop__left">
              <div class="gameTitle" id="gameTitle">—</div>
              <div class="muted" id="gameSub">—</div>
            </div>
            <div class="gameTop__right">
              <button class="btn btn--small btn--ghost" id="btnUseSkip">
                <span class="material-icons">skip_next</span> تخطي
              </button>
              <button class="btn btn--small btn--ghost" id="btnUseHelp">
                <span class="material-icons">bolt</span> مساعدة
              </button>
              <button class="btn btn--small btn--ghost" id="btnHelpLog">
                <span class="material-icons">history</span> سجل المساعدات
              </button>
              <button class="btn btn--small btn--danger" id="btnAbortLesson">
                <span class="material-icons">close</span> إلغاء
              </button>
            </div>
          </div>

          <div class="divider"></div>

          <div class="miniGrid" style="margin-top:0">
            <div class="miniCard">
              <div class="miniCard__title">الوقت</div>
              <div class="bigNum" id="hudTime">0.0s</div>
              <div class="miniCard__sub muted">مؤقت اللعبة الحالية</div>
            </div>
            <div class="miniCard">
              <div class="miniCard__title">ذهب</div>
              <div class="bigNum" id="hudGold">+0</div>
              <div class="miniCard__sub muted">مكافآت معلّقة</div>
            </div>
            <div class="miniCard">
              <div class="miniCard__title">XP</div>
              <div class="bigNum" id="hudXP">+0</div>
              <div class="miniCard__sub muted">مكافآت معلّقة</div>
            </div>
            <div class="miniCard">
              <div class="miniCard__title">تقييم</div>
              <div class="bigNum" id="hudRate">+0</div>
              <div class="miniCard__sub muted">قد يزيد أو ينقص</div>
            </div>
          </div>

          <div class="divider"></div>
          <div id="gameArea" class="gameArea"></div>

          <div class="divider"></div>

          <div class="rowActions">
            <button class="btn btn--primary" id="btnNextGame">
              <span class="material-icons">arrow_forward</span> اللعبة التالية
            </button>
            <button class="btn btn--primary" id="btnGoHint">
              <span class="material-icons">task_alt</span> تقييم البطاقات
            </button>
          </div>

          <div class="muted tiny" id="pendingNote">
            مكافآت اليوم معلّقة ولن تُعتمد إلا بعد إنهاء التلميح بالكامل.
          </div>
        </div>
      </section>
    </main>
  </div>

  <div class="modalHost" id="modalHost"></div>

  <script type="module" src="app.js"></script>
</body>
</html>
